
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Nidhi Mehta">
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.0.4">
    
    
      
        <title>Database Scorer - Driverless AI Deployment Templates</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.77f3fd56.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.7fa14f5b.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../css/mermaid.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="black" data-md-color-accent="blue">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#database-scorer" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Driverless AI Deployment Templates" class="md-header__button md-logo" aria-label="Driverless AI Deployment Templates">
      
  <img src="../img/h2oai.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Driverless AI Deployment Templates
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Database Scorer
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/h2oai/dai-deployment-templates/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    h2oai/dai-deployment-templates
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Driverless AI Deployment Templates" class="md-nav__button md-logo" aria-label="Driverless AI Deployment Templates">
      
  <img src="../img/h2oai.png" alt="logo">

    </a>
    Driverless AI Deployment Templates
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/h2oai/dai-deployment-templates/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    h2oai/dai-deployment-templates
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" data-md-state="indeterminate" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Driverless AI MOJO Scoring
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Driverless AI MOJO Scoring" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Driverless AI MOJO Scoring
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../aws_lambda_scorer/" class="md-nav__link">
        AWS Lambda Scorer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../aws-sagemaker-hosted-scorer/" class="md-nav__link">
        AWS Sagemaker Hosted Scorer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../gcp/" class="md-nav__link">
        Google Cloud Run Scorer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../local-rest-scorer/" class="md-nav__link">
        Local Rest Server Scorer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../sql-jdbc-scorer/" class="md-nav__link">
        SQL JDBC Scorer
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#downloading-instructions" class="md-nav__link">
    Downloading Instructions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    Deployment
  </a>
  
    <nav class="md-nav" aria-label="Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#properties-files" class="md-nav__link">
    Properties Files
  </a>
  
    <nav class="md-nav" aria-label="Properties Files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sample-properties-file" class="md-nav__link">
    Sample Properties File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#runtime-flags" class="md-nav__link">
    Runtime Flags
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-tricks" class="md-nav__link">
    Deployment Tricks
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/h2oai/dai-deployment-templates/edit/master/docs/dai-mojo-db.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="database-scorer">Database Scorer<a class="headerlink" href="#database-scorer" title="Permanent link">&para;</a></h1>
<p>Some customers need to select rows from a Database, score and write back the predictions.Using DAI and then this program enables them to quickly build and use models.
This scorer contains scoring implementation for Driverless AI Model MOJO pipiline with Java runtime on various different databases and can be used to do Real-time scoring on single or multiple rows.</p>
<p>Database Scorer Supports following databases
1. Postgres DB
2. Microsoft SQL Server 12
3. TerraData
4. RedShift
5. Oracle
6. DB2
7. Azure Data Warehouse
8. Snowflake
9. ElasticSearch</p>
<h2 id="downloading-instructions">Downloading Instructions<a class="headerlink" href="#downloading-instructions" title="Permanent link">&para;</a></h2>
<p>You can download the database scorer from the <a href="https://s3.amazonaws.com/artifacts.h2o.ai/releases/ai/h2o/dai-custom-scorers/downloads/index.in.html">downloads page</a></p>
<h2 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>You must have a DAI license to score, so add the license (via command line) in one of the standard ways, as a parameter, as a environment vailable for example:
    <code>Dai.h2o.mojos.runtime.license.file=/Driverless-AI/license/license.sig</code>
    ```
    The license can also be passed:</p>
<ol>
<li>Environment variable DRIVERLESS_AI_LICENSE_FILE : A location of file with a license.</li>
<li>Environment variable DRIVERLESS_AI_LICENSE_KEY : A license key.</li>
<li>System properties of JVM (-D option) 'ai.h2o.mojos.runtime.license.file' : A location of  </li>
<li>System properties of JVM (-D option) 'ai.h2o.mojos.runtime.license.key' : A license key.</li>
<li>Classpath: The license is loaded from resource called '/license.sig' The default resource name can be changed via system property 'ai.h2o.mojos.runtime.license.filename'
```</li>
</ol>
</li>
<li>
<p>To run the database scorer, you can directly run the executable jar:
    <code>java -Dpropertiesfilename={PATH_TO_PROPERTIES_FILE} -jar build/libs/dai-mojo-db-{YOUR_CURRENT_VERSION}.jar</code></p>
</li>
</ul>
<h3 id="properties-files">Properties Files<a class="headerlink" href="#properties-files" title="Permanent link">&para;</a></h3>
<p>Using the flag -Dpropertiesfilename= multiple configuration files can be created for different models or databases, just specify the properties file to use at runtime.</p>
<h4 id="sample-properties-file">Sample Properties File<a class="headerlink" href="#sample-properties-file" title="Permanent link">&para;</a></h4>
<pre><code>ModelName=pipeline.mojo
SQLConnectionString=jdbc:postgresql://192.168.1.171:5432/LendingClub SQLUser=postgres
SQLPassword=aDJvaDJvCg==
SQLPrompt=
SQLKey=id
SQLPrediction=
SQLSelect=select id, loan_amnt, term, int_rate, installment, emp_length, home_ownership, annual_inc, verification_status, addr_state, dti, delinq_2yrs, inq_last_6mths, pub_rec, revol_bal, revol_util, total_acc from &quot;import&quot;.loanstats4
SQLWrite=update &quot;import&quot;.loanstats4 set where id=
</code></pre>
<p>The above will score using <strong>pipeline.mojo</strong> and use the key 'id' to update the column name from the mojo into the table, to <code>bad_loan.0</code> and <code>bad_loan.1</code> must be in the table schema.</p>
<p>If SQLPrediction was set to ModelPrediction (for example) then <code>bad_loan.0</code> would be written to the table column ModelPrediction.</p>
<h4 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h4>
<pre><code>java -Dpropertiesfilename=DAI-Mojo-DB/properties/DAIMojoRunner_DB.properties-Snowflake -jar DAI-Mojo-DB/build/libs/dai-mojo-db-2.30.jar
</code></pre>
<h3 id="runtime-flags">Runtime Flags<a class="headerlink" href="#runtime-flags" title="Permanent link">&para;</a></h3>
<p>While the Database and Mojo configuration is in the properties file, the command line does have some flags</p>
<ul>
<li><code>-Dverbose=true</code> | false{default}     <br />
      verbosity flag</li>
<li><code>-Doverride=true</code>| false{default}   <br />
      bypass check if running multithreads on a table without an index, as the table would be in a random order.</li>
<li><code>-Dwait=true</code>| false: {default}     <br />
      causes the program to wait for Enter once the model and threads are ready, used for demos.</li>
<li><code>-Dstats=true</code> | false{default}<br />
      writes performance statistics at completion.</li>
<li><code>-Dinspect=true</code>| false{default}<br />
      prints model details and suggest SQLSelect based on model as well as runtime java memory settings.</li>
<li><code>-Dcapacity=</code> Number of available Cores+33%{default}<br />
     Size of buffer queue.</li>
<li><code>-Dthreads=</code> Number of available Cores{default}</li>
<li><code>-Dpropertiesfilename=DAIMojoRunner_DB.properties</code>{default}      <br />
      allows multiple properties files to be created for different models and databases</li>
</ul>
<p>Example:</p>
<pre><code>java -Derrors=true -Dverbose=true -Dthreads=2 -Dcapacity=4000 -Xms2g -Xmx10g -Dpropertiesfilename={PATH_TO_PROPERTIES_FILE} -jar build/libs/dai-mojo-db-{YOUR_CURRENT_VERSION}.jar
</code></pre>
<h2 id="deployment-tricks">Deployment Tricks<a class="headerlink" href="#deployment-tricks" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Its important to also have a key for each row being scored, this is because the scorer will execute in parallel (based on the -Dthreads= parameter) 
so updating the databases will be faster if a unique key is used for each row (use a customer id or even the row number) for the SQLKey statement.</p>
</li>
<li>
<p>The option -Dinsepect=true can be used to generate the SQL based on the model, this helps when a large number of database columns are required.</p>
<p>This example assumes the model is called <code>pipeline.mojo</code> but could be change using the properties file.
```</p>
<h1 id="input">input<a class="headerlink" href="#input" title="Permanent link">&para;</a></h1>
<p>java -Dinspect=true -jar DAIMojoRunner_DB.jar</p>
<h1 id="output">output<a class="headerlink" href="#output" title="Permanent link">&para;</a></h1>
<p>Details of Model: pipeline.mojo
UUID: b2fce6c1-6ddc-4c78-8355-f437945a613c Input Features
0 = Name: loan_amnt Type: Float32
1 = Name: term Type: Str
2 = Name: int_rate Type: Float32
3 = Name: installment Type: Float32
4 = Name: emp_length Type: Float32
5 = Name: home_ownership Type: Str
6 = Name: annual_inc Type: Float32
7 = Name: verification_status Type: Str
8 = Name: addr_state Type: Str
9 = Name: dti Type: Float32
10 = Name: delinq_2yrs Type: Float32
11 = Name: inq_last_6mths Type: Float32
12 = Name: pub_rec Type: Float32
13 = Name: revol_bal Type: Float32
14 = Name: revol_util Type: Float32
15 = Name: total_acc Type: Float32
Output Features
0 = Name: bad_loan.0 Type: Float64
1 = Name: bad_loan.1 Type: Float64
Suggested configuration for properties file:</p>
<p>select {add-table-index}, loan_amnt, term, int_rate, installment, emp_length, home_ownership, annual_inc, verification_status, addr_state, dti, delinq_2yrs, inq_last_6mths, pub_rec, revol_bal, revol_util, total_acc from {add-table-name}</p>
<p>update {add-table-name} set where {add-table-index}=
```</p>
</li>
</ul>
<p><strong>Note</strong> </p>
<blockquote>
<p>Change the values in {} above and manually test before using them in the program.</p>
<p>The System has 16GB available physically. This program is using 0GB Consider adjusting <code>-Xms</code> and <code>-Xmx</code> to no more than 12GB
The System has 8 Processors</p>
</blockquote>
<h2 id="handling-passwords">Handling Passwords<a class="headerlink" href="#handling-passwords" title="Permanent link">&para;</a></h2>
<h3 id="support-for-encrypted-password">Support For Encrypted Password<a class="headerlink" href="#support-for-encrypted-password" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Store the encrypted password in the DAIMojoRunner_DB.properties</p>
</li>
<li>
<p>Encrypt the password from Linux command line: (type in the password):
  <code>echo h2oh2o | base64 -i –</code>  </p>
</li>
<li>
<p>Encrypt the password from Windows PowerShell (password passed as h2oh2o)
  <code></code>
  Save the encrypted string to the SQLPassword parameter</p>
</li>
<li>
<p>The password encryption can also be performed by setting the SQLPrompt to encrypt then run 
  <code>java -jar DAIMojoRunner_DB.jar</code>   <br />
  you will be prompted to enter the JDBC password, it will then be encrypted so you can paste it into the properties file. </p>
</li>
</ul>
<h3 id="prompting-for-password">Prompting for password<a class="headerlink" href="#prompting-for-password" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Set <code>SQLPrompt= Enables</code> prompting for the password in the <code>DAIMojoRunner_DB.properties</code></p>
</li>
<li>
<p>Add the username to the SQLUser line make sure SQLPassword, is set <code>SQLPassword=Set</code> <code>SQLPrompt=true</code></p>
</li>
</ul>
<h4 id="using-environment-variables">Using Environment Variables<a class="headerlink" href="#using-environment-variables" title="Permanent link">&para;</a></h4>
<p>If the execution environment has variables with the values for the parameters they can be used in the properties file. The setting <code>EnvVariables=true</code> must be in the properties file ideally the first line or before substitution is needed.</p>
<p>Then use the environment variables like this:    </p>
<pre><code>jdbc:sqlserver://'$ADW_HOST';databaseName='$ADW_DB';user='$ADW_USER';password='$ADW_PWD'
</code></pre>
<p><strong>Variable names start with $ and are delimited by '</strong> </p>
<p>For example:  </p>
<pre><code># IF THE ENVIRONMENTS ARE...  

ADW_DB=MyDatabase    
ADW_HOST=127.0.0.1:5033 
ADW_PWD=%@#$^*   
ADW_USER=Admin 

# AT RUNTIME IT WOULD SUBSTITUTE TO...

jdbc:sqlserver://127.0.0.1:5033;databaseName=MyDatabase;user=Admin;password=%@#$^*

</code></pre>
<h4 id="using-windows-active-directory">Using Windows Active Directory<a class="headerlink" href="#using-windows-active-directory" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Some scoring environments want to use the credentials of the user executing the scoring rather than a service account.</p>
</li>
<li>
<p>The score can use the AD for this, follow these steps: </p>
<ol>
<li>Add to the command line:
   <code>-Djava.library.path=\sqljdbc_6.0\auth</code>            </li>
<li>Add to the SQLConnectionString
    <code>;integratedSecurity=true</code></li>
</ol>
</li>
</ul>
<p>For Example </p>
<p>The command line would look like this: </p>
<pre><code>java -Xms4g -Xmx4g -Dlogging=true -Dpropertiesfilename=DAIMojoRunner_DB.properties-MSSQL-Auth -Dai.h2o.mojos.runtime.license.file={PATH_TO_LICENSE}/license.sig -Djava.library.path=C:\sqljdbc_6.0\enu\auth\x64 -cp {PATH_TO_JAR}/dai-mojo-db-2.30.jar ai.h2oai.mojos.db.daimojorunner_db.DAIMojoRunner_DB   
</code></pre>
<p>The SQLConnectionString in the properties file would look like this: </p>
<pre><code>SQLConnectionString=jdbc:sqlserver://192.168.1.173:1433;databaseName=LendingClub;integratedSecurity=true
</code></pre>
<p>The SQLUser and SQLPassword would be commented out.</p>
<h2 id="result">Result<a class="headerlink" href="#result" title="Permanent link">&para;</a></h2>
<p>The DB scorer stores the score/prediction for each row from the given dataset in a file called <code>results.csv</code> in the main directory.</p>
<pre><code>java -Derrors=true -Dverbose=true -Dthreads=2 -Dcapacity=4000 -Xms2g -Xmx10g -Dpropertiesfilename=properties/DAIMojoRunner_DB.properties-Snowflake -jar build/libs/dai-mojo-db-2.30.jar

H2O DAI Mojo Database Scoring v2.30

Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Propertry EnvVariables not found in properties file, setting to default
Property EnvVariables = false
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Propertry IgnoreEmptyStrings not found in properties file, setting to default
Property IgnoreEmptyStrings = False
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Propertry IgnoreChecks not found in properties file, setting to default
Property IgnoreChecks = False
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Propertry IgnoreSQLChecks not found in properties file, setting to default
Property IgnoreSQLChecks = False
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Propertry ForceConnection not found in properties file, setting to default
Property ForceConnection = False
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Propertry ForceConnectionClass not found in properties file, setting to default
Property ForceConnectionClass = 
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Property ModelName = Mojo/pipeline.mojo
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Property SQLConnectionString = jdbc:snowflake://h20_ai_partner.snowflakecomputing.com/?warehouse=DEMO_WH&amp;db=LENDINGCLUB&amp;schema=PUBLIC
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Property SQLUser = VIYENGAR
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Property SQLPassword = MjMwN0xlZ2hvcm4=
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Propertry SQLPrompt not found in properties file, setting to default
Property SQLPrompt = 
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Property SQLSelect = select id, loan_amnt, term, int_rate,  installment,  emp_length,  home_ownership,  annual_inc,  verification_status,  addr_state,  dti,  delinq_2yrs,  inq_last_6mnths,  pub_rec,  revol_bal,  revol_util,  total_acc  from &quot;LENDINGCLUB&quot;;
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Property SQLWrite = CSV
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Property SQLWriteCSVFilename = results.csv
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Propertry SQLWriteBatch not found in properties file, setting to default
Property SQLWriteBatch = 
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Propertry SQLWriteBatchSize not found in properties file, setting to default
Property SQLWriteBatchSize = 100000
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Property SQLKey = id
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Propertry SQLPrediction not found in properties file, setting to default
Property SQLPrediction = 
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Propertry SQLPredictionLabel not found in properties file, setting to default
Property SQLPredictionLabel = 
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Propertry SQLFieldSeperator not found in properties file, setting to default
Property SQLFieldSeperator = ,
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Propertry InternalFieldSeperator not found in properties file, setting to default
Property InternalFieldSeperator = ,
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Propertry SQLWriteFieldSeperator not found in properties file, setting to default
Property SQLWriteFieldSeperator = ,
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Property SQLStartScript = snowflake/SnowflakeStart.sql
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Property SQLEndScript = snowflake/SnowflakeUpdate.sql
Using properties file: properties/DAIMojoRunner_DB.properties-Snowflake
Propertry Threshold not found in properties file, setting to default
Property Threshold = 
Using model Mojo/pipeline.mojo
TQ: 4000 2
Queue Capacity Starting 4000
Connection string used seperate SQL parameters
Reader connected to database! {}
Running SQL Script snowflake/SnowflakeStart.sql
Script init completed 
Invoking SQL Script snowflake/SnowflakeStart.sql
select count(*) from &quot;LENDINGCLUB&quot;

COUNT(*)    
39029   
delete from &quot;RESULTS&quot;

select count(*) from &quot;RESULTS&quot;

COUNT(*)    
 0  
SQL Script completed 
Reading ResultSet for select id, loan_amnt, term, int_rate,  installment,  emp_length,  home_ownership,  annual_inc,  verification_status,  addr_state,  dti,  delinq_2yrs,  inq_last_6mnths,  pub_rec,  revol_bal,  revol_util,  total_acc  from &quot;LENDINGCLUB&quot;;
ID,  LOAN_AMNT,  TERM,  INT_RATE,  INSTALLMENT,  EMP_LENGTH,  HOME_OWNERSHIP,  ANNUAL_INC,  VERIFICATION_STATUS,  ADDR_STATE,  DTI,  DELINQ_2YRS,  INQ_LAST_6MNTHS,  PUB_REC,  REVOL_BAL,  REVOL_UTIL,  TOTAL_ACC
RAW ResultSet: 1077501
RAW ResultSet: 5000
RAW ResultSet: 36 months
RAW ResultSet: 10.65
RAW ResultSet: 162.87
RAW ResultSet: 10
RAW ResultSet: RENT
RAW ResultSet: 24000

...

Script init completed 
Invoking SQL Script snowflake/SnowflakeUpdate.sql
put file://results.csv @~/staged

source  target  source_size target_size source_compression  target_compression  status  encryption  message 
results.csv results.csv.gz  1783130 814416  NONE    GZIP    UPLOADED    ENCRYPTED       
copy into RESULTS from @~/staged file_format = ( type = CSV)

remove @~/stages/results.csv.gz

name    result  
select count(*) from &quot;RESULTS&quot;

COUNT(*)    
39029   
SQL Script completed 
</code></pre>
<p><strong>Note</strong> </p>
<blockquote>
<p>Please create a <code>results.csv</code> file in the main directory (if it doesn't exist already). </p>
<p>It is important for the execution of the above command to have a <code>results.csv</code> file in the main dir to save the data processed by the scorer as the code <strong>will not create the file itself if it doesn't exist</strong>.</p>
</blockquote>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            © Copyright 2017-2020 H2O.ai
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.9b151c6a.min.js"></script>
      
        <script src="../javascripts/mermaid.min.js"></script>
      
        <script src="../javascripts/nav-expand.js"></script>
      
    
  </body>
</html>